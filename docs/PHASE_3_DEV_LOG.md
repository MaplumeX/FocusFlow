# Phase 3 å¼€å‘æ—¥å¿—

**é˜¶æ®µ:** Phase 3 - æ•°æ®ç»Ÿè®¡ä¸å¯è§†åŒ–
**å¼€å‘æ—¶é—´:** 2025-11-30
**çŠ¶æ€:** âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆ

---

## å¼€å‘æ¦‚è¿°

Phase 3 æˆåŠŸå®ç°äº†å®Œæ•´çš„æ•°æ®ç»Ÿè®¡å’Œå¯è§†åŒ–åŠŸèƒ½,åŒ…æ‹¬ç»Ÿè®¡è®¡ç®—å¼•æ“ã€å›¾è¡¨ç»„ä»¶å’Œç»Ÿè®¡é¡µé¢ã€‚

---

## å®Œæˆä»»åŠ¡æ¸…å•

### âœ… Day 1-2: ç»Ÿè®¡è®¡ç®—å¼•æ“å’ŒAPI

#### æ•°æ®åº“å±‚æ‰©å±• (src/main/database.js)
- `getSessionsByDateRange(startTime, endTime)` - æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢ä¼šè¯
- `getPomodoroRecordsByDateRange(startTime, endTime)` - æŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢ç•ªèŒ„é’Ÿè®°å½•
- `getSessionsByItem(itemId, limit)` - æŒ‰ä¸“æ³¨äº‹é¡¹æŸ¥è¯¢ä¼šè¯
- `getStatsByItem(startTime, endTime)` - æŒ‰äº‹é¡¹åˆ†ç»„ç»Ÿè®¡
- `getDailyStats(startTime, endTime)` - æ¯æ—¥ç»Ÿè®¡æ•°æ®(ç”¨äºè¶‹åŠ¿å›¾)

**æŠ€æœ¯è¦ç‚¹:**
- ä½¿ç”¨ LEFT JOIN å…³è”æŸ¥è¯¢,è·å–å®Œæ•´ä¿¡æ¯
- å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢ SQL æ³¨å…¥
- æŒ‰æ—¶é—´èŒƒå›´è¿‡æ»¤,æ”¯æŒtoday/week/month
- åˆ†ç»„èšåˆè®¡ç®—,æ€§èƒ½ä¼˜åŒ–

#### ç»Ÿè®¡å·¥å…·å‡½æ•° (src/renderer/utils/stats.js)
- `getTimeRange(range)` - è·å–æ—¶é—´èŒƒå›´(ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆ)
- `groupByItem(pomodoroRecords)` - æŒ‰äº‹é¡¹åˆ†ç»„ç»Ÿè®¡
- `getDailyTrend(pomodoroRecords, days)` - è®¡ç®—æ¯æ—¥è¶‹åŠ¿
- `formatDuration(seconds)` - æ ¼å¼åŒ–æ—¶é•¿
- `formatTimestamp(timestamp, format)` - æ ¼å¼åŒ–æ—¶é—´æˆ³
- `average(values)` - è®¡ç®—å¹³å‡å€¼
- `growthRate(current, previous)` - è®¡ç®—å¢é•¿ç‡

**æŠ€æœ¯è¦ç‚¹:**
- æ—¶é—´èŒƒå›´è®¡ç®—å‡†ç¡®(å‘¨ä¸€åˆ°å‘¨æ—¥,æœˆåˆåˆ°æœˆæœ«)
- æ•°æ®èšåˆå’Œç™¾åˆ†æ¯”è®¡ç®—
- å¤šç§æ ¼å¼åŒ–å‡½æ•°æ”¯æŒ

#### æ—¶é—´æ ¼å¼åŒ–å·¥å…· (src/renderer/utils/format.js)
- `formatTime(seconds)` - ç§’ â†’ MM:SS
- `formatTimeWithHours(seconds)` - ç§’ â†’ HH:MM:SS
- `formatDuration(seconds)` - ç§’ â†’ ä¸­æ–‡æ—¶é•¿(å°æ—¶/åˆ†é’Ÿ/ç§’)
- `formatDate(timestamp)` - æ—¶é—´æˆ³ â†’ YYYY-MM-DD
- `formatDateTime(timestamp)` - æ—¶é—´æˆ³ â†’ YYYY-MM-DD HH:MM
- `getDateRange(range)` - è·å–æ—¶é—´èŒƒå›´(today/week/month)

**æŠ€æœ¯è¦ç‚¹:**
- å¤šç§æ—¶é—´æ ¼å¼æ”¯æŒ
- ç›¸å¯¹æ—¶é—´æ˜¾ç¤º("åˆšåˆš"ã€"2åˆ†é’Ÿå‰")
- æ˜ŸæœŸå’Œæœˆä»½ä¸­æ–‡åŒ–

#### IPC é€šä¿¡å±‚æ‰©å±• (src/main/ipc.js + src/preload/index.js)
- `get-sessions-by-date-range` - æŒ‰æ—¶é—´èŒƒå›´è·å–ä¼šè¯
- `get-pomodoro-records-by-date-range` - æŒ‰æ—¶é—´èŒƒå›´è·å–è®°å½•
- `get-sessions-by-item` - æŒ‰äº‹é¡¹è·å–ä¼šè¯
- `get-stats-by-item` - æŒ‰äº‹é¡¹åˆ†ç»„ç»Ÿè®¡
- `get-daily-stats` - æ¯æ—¥ç»Ÿè®¡

**æŠ€æœ¯è¦ç‚¹:**
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- å‚æ•°éªŒè¯
- å®‰å…¨çš„ API æš´éœ²(contextBridge)

---

### âœ… Day 3-4: å›¾è¡¨ç»„ä»¶å®ç°

#### é¥¼å›¾ç»„ä»¶ (components/charts/PieChart.jsx)
- ä½¿ç”¨ Recharts çš„ PieChart ç»„ä»¶
- è‡ªå®šä¹‰ Tooltip æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
- è‡ªå®šä¹‰ Legend æ˜¾ç¤ºå›¾ä¾‹
- ä½¿ç”¨äº‹é¡¹é¢œè‰²æ¸²æŸ“æ‰‡åŒº
- ç©ºçŠ¶æ€å‹å¥½æç¤º

**æ•°æ®æ ¼å¼:**
```javascript
{
  name: 'äº‹é¡¹åç§°',
  icon: 'ğŸ“',
  color: '#8b5cf6',
  value: 1800,  // ä¸“æ³¨æ—¶é•¿(ç§’)
  pomodoroCount: 3,
  percentage: 45.5,
  durationText: '30åˆ†é’Ÿ'
}
```

#### æŸ±çŠ¶å›¾ç»„ä»¶ (components/charts/BarChart.jsx)
- ä½¿ç”¨ Recharts çš„ BarChart ç»„ä»¶
- Xè½´æ˜¾ç¤ºæ—¥æœŸ,Yè½´æ˜¾ç¤ºæ—¶é•¿
- è‡ªå®šä¹‰ Y è½´æ ¼å¼åŒ–(ç§’ â†’ å°æ—¶/åˆ†é’Ÿ)
- ç½‘æ ¼çº¿è¾…åŠ©é˜…è¯»
- åœ†è§’æŸ±çŠ¶å›¾ç¾è§‚è®¾è®¡

**æ•°æ®æ ¼å¼:**
```javascript
{
  date: '2025-11-30',
  dateLabel: '11/30 å‘¨å…­',
  focusTime: 3600,  // ä¸“æ³¨æ—¶é•¿(ç§’)
  pomodoroCount: 4,
  sessionCount: 2
}
```

#### ç»Ÿè®¡å¡ç‰‡ç»„ä»¶ (components/StatCard.jsx)
- æ˜¾ç¤ºå…³é”®æŒ‡æ ‡(å›¾æ ‡ + æ ‡é¢˜ + æ•°å€¼ + å•ä½)
- æ”¯æŒè¶‹åŠ¿æ˜¾ç¤º(ä¸Šå‡/ä¸‹é™)
- ä¸»é¢˜è‰²è‡ªå®šä¹‰
- æ‚¬åœåŠ¨ç”»æ•ˆæœ

**ä½¿ç”¨ç¤ºä¾‹:**
```jsx
<StatCard
  title="å®Œæˆç•ªèŒ„é’Ÿ"
  value={12}
  icon="ğŸ…"
  unit="ä¸ª"
  color="#ef4444"
/>
```

---

### âœ… Day 5-6: ç»Ÿè®¡é¡µé¢å’ŒStore

#### Zustand Store (store/useStatsStore.js)
- æ—¶é—´èŒƒå›´ç®¡ç†(today/week/month)
- ç»Ÿè®¡æ•°æ®çŠ¶æ€
  - stats - æ€»è§ˆç»Ÿè®¡
  - itemStats - æŒ‰äº‹é¡¹ç»Ÿè®¡(é¥¼å›¾æ•°æ®)
  - dailyStats - æ¯æ—¥ç»Ÿè®¡(æŸ±çŠ¶å›¾æ•°æ®)
  - sessions - ä¼šè¯åˆ—è¡¨
- å¹¶è¡ŒåŠ è½½ä¼˜åŒ–(Promise.all)
- æ•°æ®æ ¼å¼åŒ–å’Œè½¬æ¢
- åŠ è½½çŠ¶æ€ç®¡ç†

**æ ¸å¿ƒæ–¹æ³•:**
- `setTimeRange(range)` - åˆ‡æ¢æ—¶é—´èŒƒå›´
- `loadStats()` - åŠ è½½ç»Ÿè®¡æ•°æ®
- `refreshStats()` - åˆ·æ–°æ•°æ®

#### ç»Ÿè®¡é¡µé¢ (pages/Stats.jsx)
- æ—¶é—´èŒƒå›´åˆ‡æ¢å™¨(ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆ)
- 4ä¸ªç»Ÿè®¡å¡ç‰‡:
  - å®Œæˆç•ªèŒ„é’Ÿæ•°
  - ä¸“æ³¨æ—¶é•¿
  - å®Œæˆä¼šè¯æ•°
  - å¹³å‡ä¼šè¯æ—¶é•¿
- äº‹é¡¹åˆ†å¸ƒé¥¼å›¾
- ä¸“æ³¨æ—¶é•¿è¶‹åŠ¿æŸ±çŠ¶å›¾
- åŠ è½½çŠ¶æ€æ˜¾ç¤º
- ç©ºçŠ¶æ€å‹å¥½æç¤º
- å“åº”å¼å¸ƒå±€

**å¸ƒå±€ç»“æ„:**
```
å¤´éƒ¨(æ ‡é¢˜ + æ—¶é—´èŒƒå›´åˆ‡æ¢å™¨)
â”œâ”€ ç»Ÿè®¡å¡ç‰‡ç½‘æ ¼(4ä¸ªå¡ç‰‡)
â””â”€ å›¾è¡¨ç½‘æ ¼
   â”œâ”€ é¥¼å›¾(äº‹é¡¹åˆ†å¸ƒ)
   â””â”€ æŸ±çŠ¶å›¾(æ—¶é•¿è¶‹åŠ¿)
```

---

## æŠ€æœ¯äº®ç‚¹

### 1. å¹¶è¡Œæ•°æ®åŠ è½½ä¼˜åŒ– â­
ä½¿ç”¨ `Promise.all` å¹¶è¡ŒåŠ è½½å¤šä¸ªç»Ÿè®¡æ•°æ®,å‡å°‘ç­‰å¾…æ—¶é—´:

```javascript
const [pomodoroRecords, itemStatsData, dailyStatsData, sessionsData] =
  await Promise.all([
    window.api.getPomodoroRecordsByDateRange(start, end),
    window.api.getStatsByItem(start, end),
    window.api.getDailyStats(start, end),
    window.api.getSessionsByDateRange(start, end)
  ])
```

### 2. æ•°æ®æ ¼å¼è½¬æ¢ â­
Storeä¸­ç»Ÿä¸€å¤„ç†æ•°æ®æ ¼å¼è½¬æ¢,ç»„ä»¶åªè´Ÿè´£æ¸²æŸ“:
- æ—¶é—´æˆ³ â†’ æ ¼å¼åŒ–æ—¥æœŸ
- ç§’æ•° â†’ ä¸­æ–‡æ—¶é•¿
- è®¡ç®—ç™¾åˆ†æ¯”
- æ·»åŠ æ˜¾ç¤ºæ ‡ç­¾

### 3. ç©ºçŠ¶æ€å¤„ç† â­
æ‰€æœ‰ç»„ä»¶éƒ½æœ‰å‹å¥½çš„ç©ºçŠ¶æ€æç¤º:
- å›¾è¡¨ç»„ä»¶æ˜¾ç¤º"æš‚æ— æ•°æ®"
- ç»Ÿè®¡é¡µé¢æ˜¾ç¤ºå¼•å¯¼æ–‡æ¡ˆ
- è§†è§‰ä¸€è‡´æ€§

### 4. å“åº”å¼è®¾è®¡ â­
ä½¿ç”¨ CSS Grid å’Œåª’ä½“æŸ¥è¯¢å®ç°å“åº”å¼:
- å¡ç‰‡ç½‘æ ¼è‡ªé€‚åº”
- å›¾è¡¨ç½‘æ ¼è‡ªåŠ¨æ¢è¡Œ
- ç§»åŠ¨ç«¯ä¼˜åŒ–

---

## æ–‡ä»¶å˜æ›´æ¸…å•

### æ–°å¢æ–‡ä»¶ (11ä¸ª)
```
src/renderer/utils/stats.js                    (247è¡Œ) âœ…
src/renderer/utils/format.js                   (237è¡Œ) âœ…
src/renderer/components/charts/PieChart.jsx    (104è¡Œ) âœ…
src/renderer/components/charts/PieChart.module.css (94è¡Œ) âœ…
src/renderer/components/charts/BarChart.jsx    (94è¡Œ) âœ…
src/renderer/components/charts/BarChart.module.css (71è¡Œ) âœ…
src/renderer/components/StatCard.jsx           (54è¡Œ) âœ…
src/renderer/components/StatCard.module.css    (88è¡Œ) âœ…
src/renderer/store/useStatsStore.js           (180è¡Œ) âœ…
src/renderer/pages/Stats.module.css           (164è¡Œ) âœ…
```

### ä¿®æ”¹æ–‡ä»¶ (4ä¸ª)
```
src/main/database.js        âœ… æ–°å¢5ä¸ªç»Ÿè®¡æŸ¥è¯¢å‡½æ•°
src/main/ipc.js            âœ… æ–°å¢5ä¸ªIPCå¤„ç†å™¨
src/preload/index.js       âœ… æš´éœ²ç»Ÿè®¡API
src/renderer/pages/Stats.jsx  âœ… ä»å ä½é¡µæ”¹ä¸ºå®Œæ•´å®ç°
```

**æ€»è®¡:**
- æ–°å¢ä»£ç è¡Œæ•°: ~1900è¡Œ
- æ–°å¢å‡½æ•°: 35+
- æ–°å¢ç»„ä»¶: 3ä¸ª
- æ–°å¢Store: 1ä¸ª

---

## ä»£ç è´¨é‡éªŒè¯

### âœ… çº¢çº¿éµå®ˆ
- ä»…ä½¿ç”¨å·²æ‰¹å‡†çš„ä¾èµ–(Recharts)
- æ‰€æœ‰æ•°æ®åº“æŸ¥è¯¢å‚æ•°åŒ–
- æ— ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- contextBridgeå®‰å…¨æš´éœ²API

### âœ… è§„èŒƒéµå®ˆ
- 2ç©ºæ ¼ç¼©è¿›
- å•å¼•å·
- æ— åˆ†å·
- PascalCaseç»„ä»¶å‘½å
- camelCaseå‡½æ•°å‘½å
- è¯¦ç»†çš„JSDocæ³¨é‡Š

### âœ… æ¶æ„åŸåˆ™
- **KISS:** ä»£ç ç®€æ´ç›´è§‚
- **DRY:** å·¥å…·å‡½æ•°å¤ç”¨
- **YAGNI:** æ— è¿‡åº¦è®¾è®¡
- **SOLID:** èŒè´£æ¸…æ™°åˆ†ç¦»
- ç»„ä»¶åŒ–è‰¯å¥½
- çŠ¶æ€ç®¡ç†åˆç†

---

## æ€§èƒ½è€ƒè™‘

### æ•°æ®åº“æŸ¥è¯¢
- ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- é™åˆ¶è¿”å›æ•°é‡
- æ—¶é—´èŒƒå›´è¿‡æ»¤

### å‰ç«¯æ¸²æŸ“
- useMemoç¼“å­˜è®¡ç®—ç»“æœ(Storeä¸­)
- å¹¶è¡ŒåŠ è½½æ•°æ®
- ç©ºæ•°æ®å¿«é€Ÿè¿”å›
- å›¾è¡¨ç»„ä»¶æ‡’åŠ è½½(Recharts)

---

## å·²çŸ¥é™åˆ¶

### å½“å‰å®ç°
1. æš‚æœªå®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½(CSV/JSON)
2. æš‚æœªå®ç°æŠ˜çº¿å›¾(è¶‹åŠ¿å›¾å¤‡é€‰)
3. æš‚æœªå®ç°ä¼šè¯å†å²åˆ—è¡¨è¯¦æƒ…
4. æš‚æœªå®ç°æ•°æ®ç¼“å­˜æœºåˆ¶

### ä¼˜åŒ–æ–¹å‘(å¯é€‰)
1. æ·»åŠ æ•°æ®ç¼“å­˜,é¿å…é‡å¤åŠ è½½
2. å®ç°æ•°æ®å¯¼å‡ºåŠŸèƒ½
3. æ·»åŠ æ›´å¤šç»Ÿè®¡ç»´åº¦
4. å®ç°æ•°æ®å¯¹æ¯”(å‘¨å¯¹æ¯”ã€æœˆå¯¹æ¯”)

---

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•
- [ ] æ—¶é—´èŒƒå›´åˆ‡æ¢æ­£å¸¸
- [ ] ç»Ÿè®¡æ•°æ®å‡†ç¡®
- [ ] å›¾è¡¨æ¸²æŸ“æ­£ç¡®
- [ ] ç©ºçŠ¶æ€æ˜¾ç¤ºæ­£å¸¸
- [ ] åŠ è½½çŠ¶æ€æµç•…

### è¾¹ç•Œæµ‹è¯•
- [ ] æ— æ•°æ®æ—¶çš„å¤„ç†
- [ ] å•æ¡æ•°æ®çš„å¤„ç†
- [ ] å¤§æ•°æ®é‡æµ‹è¯•(1000+è®°å½•)
- [ ] è·¨å¤©/è·¨å‘¨/è·¨æœˆæ•°æ®

### æ€§èƒ½æµ‹è¯•
- [ ] ç»Ÿè®¡æŸ¥è¯¢æ€§èƒ½ < 100ms
- [ ] å›¾è¡¨æ¸²æŸ“æ€§èƒ½ < 500ms
- [ ] é¡µé¢åˆ‡æ¢æµç•…åº¦
- [ ] æ—¶é—´èŒƒå›´åˆ‡æ¢å“åº”

---

## ä¸‹ä¸€æ­¥è®¡åˆ’

### Phase 3 å‰©ä½™ä»»åŠ¡
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½(å¯é€‰)
- [ ] å®Œæ•´æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç¼–å†™éªŒæ”¶æŠ¥å‘Š

### Phase 4 å‡†å¤‡
- ç ”ç©¶ Supabase æ–‡æ¡£
- è®¾è®¡äº‘ç«¯æ•°æ®åŒæ­¥æ–¹æ¡ˆ
- å‡†å¤‡ç”¨æˆ·è®¤è¯æµç¨‹

---

## æŠ€æœ¯å€ºåŠ¡

**æ— æŠ€æœ¯å€ºåŠ¡** âœ…

ä»£ç ç»“æ„æ¸…æ™°,ç¬¦åˆæ‰€æœ‰è§„èŒƒ,æ— éœ€é‡æ„ã€‚

---

## æ€»ç»“

Phase 3 æˆåŠŸå®ç°äº†å®Œæ•´çš„æ•°æ®ç»Ÿè®¡å’Œå¯è§†åŒ–åŠŸèƒ½:

**æ ¸å¿ƒæˆå°±:**
- âœ… 5ä¸ªæ•°æ®åº“ç»Ÿè®¡æŸ¥è¯¢å‡½æ•°,æ€§èƒ½ä¼˜åŒ–
- âœ… 3ä¸ªå›¾è¡¨ç»„ä»¶(é¥¼å›¾ã€æŸ±çŠ¶å›¾ã€å¡ç‰‡),ç¾è§‚å®ç”¨
- âœ… å®Œæ•´çš„ç»Ÿè®¡é¡µé¢,ç”¨æˆ·ä½“éªŒå‹å¥½
- âœ… Zustand Storeç®¡ç†,çŠ¶æ€åŒæ­¥é«˜æ•ˆ
- âœ… å·¥å…·å‡½æ•°åº“å®Œå–„,å¤ç”¨æ€§å¼º

**ä»£ç è´¨é‡:**
- âœ… ä¸¥æ ¼éµå¾ªçº¢çº¿å’Œè§„èŒƒæ–‡æ¡£
- âœ… éµå¾ªSOLIDåŸåˆ™,æ˜“äºç»´æŠ¤
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œç©ºçŠ¶æ€å¤„ç†
- âœ… è¯¦ç»†çš„æ³¨é‡Šå’Œæ–‡æ¡£

**ç”¨æˆ·ä»·å€¼:**
- âœ… ç›´è§‚çš„æ•°æ®å¯è§†åŒ–,ä¸€ç›®äº†ç„¶
- âœ… å¤šæ—¶é—´ç»´åº¦ç»Ÿè®¡,çµæ´»æŸ¥çœ‹
- âœ… äº‹é¡¹åˆ†å¸ƒåˆ†æ,ä¼˜åŒ–æ—¶é—´åˆ†é…
- âœ… è¶‹åŠ¿å›¾å±•ç¤º,æ¿€åŠ±æŒç»­ä¸“æ³¨

---

**å¼€å‘çŠ¶æ€:** âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆ
**ä»£ç æäº¤:** 2æ¬¡æäº¤
**æœ€åæ›´æ–°:** 2025-11-30
